services:
  agent:
    build:
      context: .
      dockerfile: Dockerfile.agent
    container_name: agent_service
    depends_on:
      - redis
    environment:
      MONGO_URI: ${MONGO_URI:-mongodb://host.docker.internal:27017/squashdaddy_agent}
      REDIS_HOST: redis
      PYTHON_API_URL: http://host.docker.internal:8000
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      GEMINI_MODEL: ${GEMINI_MODEL:-gemini-flash-latest}
    ports:
      - "3001:3001"
    volumes:
      - .:/app
      - /app/node_modules
    command: npm run start:dev
    networks:
      - agent-network

  redis:
    image: redis:alpine
    container_name: agent_redis
    ports:
      - "6380:6379" # Mapped to 6380 to avoid conflict with local redis
    networks:
      - agent-network

networks:
  agent-network:
    driver: bridge
